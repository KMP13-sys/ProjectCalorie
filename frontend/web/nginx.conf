# ‡πÉ‡∏ä‡πâ user nginx ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
user nginx;
worker_processes auto;

# log & process config
error_log /var/log/nginx/error.log warn;
pid       /var/run/nginx.pid;

events {
  # ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô concurrent connection ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠ worker
  worker_processes 1;
  worker_connections 1024;
}

http {
  # ‡πÇ‡∏´‡∏•‡∏î MIME types ‡πÄ‡∏ä‡πà‡∏ô .html, .js, .css
  include       /etc/nginx/mime.types;
  default_type  application/octet-stream;
  sendfile      on;
  keepalive_timeout 65;

  # üîπ SERVER CONFIG
  server {
    listen 80;
    server_name _;

    # üî∏ Proxy API ‚Üí Backend Express
    location /api/ {
      # ‡∏ñ‡πâ‡∏≤ URL ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ /api/ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ backend (Express ‡∏ó‡∏µ‡πà‡∏û‡∏≠‡∏£‡πå‡∏ï 4000)
      proxy_pass http://backend:4000/;   # ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà service "backend" ‡πÉ‡∏ô docker-compose
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    # üî∏ Frontend App (Next.js build output) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    location / {
      root /usr/share/nginx/html;  # ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà COPY ‡πÑ‡∏ü‡∏•‡πå Next.js build ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Dockerfile
      index index.html;
      try_files $uri /index.html;  # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ path ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ index.html (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö React/Next routes)
    }

    # üî∏ Static Assets (CSS, JS, Images)
    location ~* \.(?:js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|json)$ {
      root /usr/share/nginx/html/public;
      expires 1y;
      add_header Cache-Control "public, immutable";
    }
  }
}
